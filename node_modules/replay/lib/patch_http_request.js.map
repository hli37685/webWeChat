{"version":3,"sources":["patch_http_request.js"],"names":["HTTP","require","ProxyRequest","Replay","URL","request","options","callback","String","parse","headers","Upgrade","ClientRequest","hostname","host","split","isLocalhost","isPassThrough","chain","start","once"],"mappings":";;AAAA;AACA;AACA;;AAEA,MAAMA,OAAgBC,QAAQ,MAAR,CAAtB;AACA,MAAMC,eAAgBD,QAAQ,SAAR,CAAtB;AACA,MAAME,SAAgBF,QAAQ,IAAR,CAAtB;AACA,MAAMG,MAAgBH,QAAQ,KAAR,CAAtB;;AAGA;AACAD,KAAKK,OAAL,GAAe,UAASC,OAAT,EAAkBC,QAAlB,EAA4B;AACzC,MAAI,OAAOD,OAAP,KAAmB,QAAnB,IAA+BA,mBAAmBE,MAAtD,EACEF,UAAUF,IAAIK,KAAJ,CAAUH,OAAV,CAAV;;AAEF;AACA,MAAIA,QAAQI,OAAR,IAAmBJ,QAAQI,OAAR,CAAgBC,OAAhB,KAA4B,WAAnD,EACE,OAAO,IAAIX,KAAKY,aAAT,CAAuBN,OAAvB,EAAgCC,QAAhC,CAAP;;AAEF,QAAMM,WAAWP,QAAQO,QAAR,IAAqBP,QAAQQ,IAAR,IAAgBR,QAAQQ,IAAR,CAAaC,KAAb,CAAmB,GAAnB,EAAwB,CAAxB,CAArC,IAAoE,WAArF;AACA,MAAIZ,OAAOa,WAAP,CAAmBH,QAAnB,KAAgCV,OAAOc,aAAP,CAAqBJ,QAArB,CAApC,EACE,OAAO,IAAIb,KAAKY,aAAT,CAAuBN,OAAvB,EAAgCC,QAAhC,CAAP;;AAEF;AACA,QAAMF,UAAU,IAAIH,YAAJ,CAAiBI,OAAjB,EAA0BH,OAAOe,KAAP,CAAaC,KAAvC,CAAhB;AACA,MAAIZ,QAAJ,EACEF,QAAQe,IAAR,CAAa,UAAb,EAAyBb,QAAzB;AACF,SAAOF,OAAP;AACD,CAjBD","file":"patch_http_request.js","sourcesContent":["// Patch HTTP.request to make all request go through Replay\n//\n// Patch based on io.js, may not work with Node.js\n\nconst HTTP          = require('http');\nconst ProxyRequest  = require('./proxy');\nconst Replay        = require('./');\nconst URL           = require('url');\n\n\n// Route HTTP requests to our little helper.\nHTTP.request = function(options, callback) {\n  if (typeof options === 'string' || options instanceof String)\n    options = URL.parse(options);\n\n  // WebSocket request: pass through to Node.js library\n  if (options.headers && options.headers.Upgrade === 'websocket')\n    return new HTTP.ClientRequest(options, callback);\n\n  const hostname = options.hostname || (options.host && options.host.split(':')[0]) || 'localhost';\n  if (Replay.isLocalhost(hostname) || Replay.isPassThrough(hostname))\n    return new HTTP.ClientRequest(options, callback);\n\n  // Proxy request\n  const request = new ProxyRequest(options, Replay.chain.start);\n  if (callback)\n    request.once('response', callback);\n  return request;\n};\n\n"],"sourceRoot":"/source/"}