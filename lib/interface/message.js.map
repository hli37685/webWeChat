{"version":3,"sources":["../../src/interface/message.js"],"names":["convertEmoji","formatNum","messageProto","init","instance","MsgType","isSendBySelf","FromUserName","user","UserName","OriginalContent","Content","indexOf","replace","match","contacts","MemberList","find","member","Contact","getDisplayName","isSendBy","contact","getPeerUserName","ToUserName","getDisplayTime","time","Date","CreateTime","getHours","getMinutes","MessageFactory","extend","messageObj","Object","setPrototypeOf"],"mappings":"AAAA,SAAQA,YAAR,EAAsBC,SAAtB,QAAsC,SAAtC;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA,MAAMC,eAAe;AACnBC,QAAM,UAAUC,QAAV,EAAoB;AACxB,SAAKC,OAAL,GAAe,CAAC,KAAKA,OAArB;AACA,SAAKC,YAAL,GAAoB,KAAKC,YAAL,KAAsBH,SAASI,IAAT,CAAcC,QAApC,IAAgD,KAAKF,YAAL,KAAsB,EAA1F;;AAEA,SAAKG,eAAL,GAAuB,KAAKC,OAA5B;AACA,QAAI,KAAKJ,YAAL,CAAkBK,OAAlB,CAA0B,IAA1B,MAAoC,CAAxC,EAA2C;AACzC,WAAKD,OAAL,GAAe,KAAKA,OAAL,CAAaE,OAAb,CAAqB,YAArB,EAAmCC,SAAS;AACzD,YAAIN,OAAOJ,SAASW,QAAT,CAAkB,KAAKR,YAAvB,EAAqCS,UAArC,CAAgDC,IAAhD,CAAqDC,UAAU;AACxE,iBAAOA,OAAOT,QAAP,KAAoBK,KAA3B;AACD,SAFU,CAAX;AAGA,eAAON,OAAOJ,SAASe,OAAT,CAAiBC,cAAjB,CAAgCZ,IAAhC,CAAP,GAA+CM,KAAtD;AACD,OALc,CAAf;AAMD;;AAED,SAAKH,OAAL,GAAe,KAAKA,OAAL,CAAaE,OAAb,CAAqB,OAArB,EAA8B,GAA9B,EAAmCA,OAAnC,CAA2C,OAA3C,EAAoD,GAApD,EAAyDA,OAAzD,CAAiE,SAAjE,EAA4E,IAA5E,CAAf;AACA,SAAKF,OAAL,GAAeX,aAAa,KAAKW,OAAlB,CAAf;;AAEA,WAAO,IAAP;AACD,GAnBkB;AAoBnBU,YAAU,UAAUC,OAAV,EAAmB;AAC3B,WAAO,KAAKf,YAAL,KAAsBe,QAAQb,QAArC;AACD,GAtBkB;AAuBnBc,mBAAiB,YAAY;AAC3B,WAAO,KAAKjB,YAAL,GAAoB,KAAKkB,UAAzB,GAAsC,KAAKjB,YAAlD;AACD,GAzBkB;AA0BnBkB,kBAAgB,YAAY;AAC1B,QAAIC,OAAO,IAAIC,IAAJ,CAAS,MAAM,KAAKC,UAApB,CAAX;AACA,WAAOF,KAAKG,QAAL,KAAkB,GAAlB,GAAwB5B,UAAUyB,KAAKI,UAAL,EAAV,EAA6B,CAA7B,CAA/B;AACD;AA7BkB,CAArB;;AAgCA,eAAe,SAASC,cAAT,CAAyB3B,QAAzB,EAAmC;AAChD,SAAO;AACL4B,YAAQ,UAAUC,UAAV,EAAsB;AAC5BA,mBAAaC,OAAOC,cAAP,CAAsBF,UAAtB,EAAkC/B,YAAlC,CAAb;AACA,aAAO+B,WAAW9B,IAAX,CAAgBC,QAAhB,CAAP;AACD;AAJI,GAAP;AAMD","file":"message.js","sourcesContent":["import {convertEmoji, formatNum} from '../util'\n/* Message Object Example\n{\n    \"FromUserName\": \"\",\n    \"ToUserName\": \"\",\n    \"Content\": \"\",\n    \"StatusNotifyUserName\": \"\",\n    \"ImgWidth\": 0,\n    \"PlayLength\": 0,\n    \"RecommendInfo\": {},\n    \"StatusNotifyCode\": 4,\n    \"NewMsgId\": \"\",\n    \"Status\": 3,\n    \"VoiceLength\": 0,\n    \"ForwardFlag\": 0,\n    \"AppMsgType\": 0,\n    \"Ticket\": \"\",\n    \"AppInfo\": {...},\n    \"Url\": \"\",\n    \"ImgStatus\": 1,\n    \"MsgType\": 1,\n    \"ImgHeight\": 0,\n    \"MediaId\": \"\",\n    \"MsgId\": \"\",\n    \"FileName\": \"\",\n    \"HasProductId\": 0,\n    \"FileSize\": \"\",\n    \"CreateTime\": 0,\n    \"SubMsgType\": 0\n}\n*/\n\nconst messageProto = {\n  init: function (instance) {\n    this.MsgType = +this.MsgType\n    this.isSendBySelf = this.FromUserName === instance.user.UserName || this.FromUserName === ''\n\n    this.OriginalContent = this.Content\n    if (this.FromUserName.indexOf('@@') === 0) {\n      this.Content = this.Content.replace(/^@.*?(?=:)/, match => {\n        let user = instance.contacts[this.FromUserName].MemberList.find(member => {\n          return member.UserName === match\n        })\n        return user ? instance.Contact.getDisplayName(user) : match\n      })\n    }\n\n    this.Content = this.Content.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/<br\\/>/g, '\\n')\n    this.Content = convertEmoji(this.Content)\n\n    return this\n  },\n  isSendBy: function (contact) {\n    return this.FromUserName === contact.UserName\n  },\n  getPeerUserName: function () {\n    return this.isSendBySelf ? this.ToUserName : this.FromUserName\n  },\n  getDisplayTime: function () {\n    var time = new Date(1e3 * this.CreateTime)\n    return time.getHours() + ':' + formatNum(time.getMinutes(), 2)\n  }\n}\n\nexport default function MessageFactory (instance) {\n  return {\n    extend: function (messageObj) {\n      messageObj = Object.setPrototypeOf(messageObj, messageProto)\n      return messageObj.init(instance)\n    }\n  }\n}\n"]}