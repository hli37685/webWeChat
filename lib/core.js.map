{"version":3,"sources":["../src/core.js"],"names":["debug","WechatCore","data","PROP","uuid","uin","sid","skey","passTicket","formatedSyncKey","webwxDataTicket","syncKey","List","CONF","COOKIE","user","botData","request","Cookie","Promise","resolve","then","method","url","API_jsLogin","window","QRLogin","eval","res","equal","code","catch","err","tips","params","API_login","notEqual","redirect_uri","match","rediUri","userAvatar","fun","pm","headers","forEach","test","item","Date","BaseRequest","getBaseRequest","API_webwxinit","BaseResponse","Ret","SKey","updateSyncKey","Object","assign","User","to","pass_ticket","lang","API_webwxstatusnotify","seq","API_webwxgetcontact","contacts","length","API_webwxbatchgetcontact","ContactList","text","JSON","stringify","API_webwxreport","API_synccheck","synccheck","ex","retcode","selector","SYNCCHECK_RET_SUCCESS","API_webwxsync","SyncKey","SyncCheckKey","synckeylist","e","o","n","push","join","redirect","type","API_webwxlogout","msg","clientMsgId","MSGTYPE_TEXT","API_webwxsendmsg","id","MSGTYPE_EMOTICON","indexOf","Msg","MediaId","EMoticonMd5","API_webwxsendemoticon","file","filename","toUserName","name","size","ext","mediatype","reject","File","constructor","Blob","Buffer","isBuffer","Error","lookup","readable","path","basename","pipe","buffer","toLowerCase","uploadMediaRequest","ClientMediaId","TotalLen","StartPos","DataLen","MediaType","UploadType","FromUserName","UserName","ToUserName","form","append","toGMTString","encodeURI","contentType","knownLength","getHeaders","f","API_webwxuploadmedia","mediaId","ok","MSGTYPE_IMAGE","API_webwxsendmsgimg","MSGTYPE_VIDEO","API_webwxsendmsgvedio","APPMSGTYPE_ATTACH","API_webwxsendappmsg","MsgType","Content","replace","SubMsgType","MSGTYPE_LOCATION","Type","OriContent","EmojiFlag","Scene","MSGTYPE_MICROVIDEO","MSGTYPE_APP","AppMsgType","msgId","MsgID","API_webwxgetmsgimg","responseType","API_webwxgetvideo","API_webwxgetvoice","HeadImgUrl","origin","FileName","sender","mediaid","fromuser","webwx_data_ticket","API_webwxdownloadmedia","Ticket","API_webwxverifyuser","content","NickName","Topic","MemberList","MemberCount","API_webwxcreatechatroom","ChatRoomUserName","ChatRoomName","AddMemberList","toString","DelMemberList","InviteMemberList","API_webwxupdatechatroom","OP","RemarkName","CmdId","API_webwxoplog","NewName","NewTopic","console","log","SvrMsgId","ClientMsgId","API_webwxrevokemsg","Uin","parseInt","Sid","Skey","DeviceID","keys","key"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AASA,IAAMA,QAAQ,qBAAO,MAAP,CAAd;;IAEqBC,U;AAEnB,sBAAaC,IAAb,EAAmB;AAAA;;AACjB,SAAKC,IAAL,GAAY;AACVC,YAAM,EADI;AAEVC,WAAK,EAFK;AAGVC,WAAK,EAHK;AAIVC,YAAM,EAJI;AAKVC,kBAAY,EALF;AAMVC,uBAAiB,EANP;AAOVC,uBAAiB,EAPP;AAQVC,eAAS;AACPC,cAAM;AADC;AARC,KAAZ;AAYA,SAAKC,IAAL,GAAY,oBAAZ;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,IAAL,GAAY,EAAZ;AACA,QAAIb,IAAJ,EAAU;AACR,WAAKc,OAAL,GAAed,IAAf;AACD;;AAED,SAAKe,OAAL,GAAe,kBAAY;AACzBC,cAAQ,KAAKJ;AADY,KAAZ,CAAf;AAGD;;;;8BAiBU;AAAA;;AACT,aAAOK,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,eAAO,MAAKJ,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,MAAKV,IAAL,CAAUW;AAFG,SAAb,EAGJH,IAHI,CAGC,eAAO;AACb,cAAII,SAAS;AACXC,qBAAS;AAEX;AACA;AAJa,WAAb,CAKAC,KAAKC,IAAI1B,IAAT;AACA,uBAAO2B,KAAP,CAAaJ,OAAOC,OAAP,CAAeI,IAA5B,EAAkC,GAAlC,EAAuCF,GAAvC;;AAEA,gBAAKzB,IAAL,CAAUC,IAAV,GAAiBqB,OAAOC,OAAP,CAAetB,IAAhC;AACA,iBAAOqB,OAAOC,OAAP,CAAetB,IAAtB;AACD,SAdM,CAAP;AAeD,OAhBM,EAgBJ2B,KAhBI,CAgBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,UAAX;AACA,cAAMD,GAAN;AACD,OApBM,CAAP;AAqBD;;;iCAEa;AAAA;;AACZ,aAAOb,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,iBAAO,CADI;AAEX,kBAAQ,OAAK/B,IAAL,CAAUC,IAFP;AAGX,uBAAa;AAHF,SAAb;AAKA,eAAO,OAAKa,OAAL,CAAa;AAClBK,kBAAQ,KADU;AAElBC,eAAK,OAAKV,IAAL,CAAUsB,SAFG;AAGlBD,kBAAQA;AAHU,SAAb,EAIJb,IAJI,CAIC,eAAO;AACb,cAAII,SAAS,EAAb;;AAEA;AACAE,eAAKC,IAAI1B,IAAT;AACA,uBAAOkC,QAAP,CAAgBX,OAAOK,IAAvB,EAA6B,GAA7B,EAAkCF,GAAlC;;AAEA,cAAIH,OAAOK,IAAP,KAAgB,GAApB,EAAyB;AACvB,mBAAKjB,IAAL,GAAY,mBAAQY,OAAOY,YAAP,CAAoBC,KAApB,CAA0B,eAA1B,EAA2C,CAA3C,CAAR,CAAZ;AACA,mBAAKC,OAAL,GAAed,OAAOY,YAAtB;AACD,WAHD,MAGO,IAAIZ,OAAOK,IAAP,KAAgB,GAAhB,IAAuBL,OAAOe,UAAlC,EAA8C;AACnD;AACD;AACD,iBAAOf,MAAP;AACD,SAlBM,CAAP;AAmBD,OAzBM,EAyBJM,KAzBI,CAyBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,cAAX;AACA,cAAMD,GAAN;AACD,OA7BM,CAAP;AA8BD;;;4BAEQ;AAAA;;AACP,aAAOb,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,eAAO,OAAKJ,OAAL,CAAa;AAClBK,kBAAQ,KADU;AAElBC,eAAK,OAAKgB,OAFQ;AAGlBL,kBAAQ;AACNO,iBAAK;AADC;AAHU,SAAb,EAMJpB,IANI,CAMC,eAAO;AACb,cAAIqB,KAAKd,IAAI1B,IAAJ,CAASoC,KAAT,CAAe,kBAAf,CAAT;AACA,cAAII,MAAMA,GAAG,CAAH,MAAU,GAApB,EAAyB;AACvB,mBAAKvC,IAAL,CAAUI,IAAV,GAAiBqB,IAAI1B,IAAJ,CAASoC,KAAT,CAAe,oBAAf,EAAqC,CAArC,CAAjB;AACA,mBAAKnC,IAAL,CAAUG,GAAV,GAAgBsB,IAAI1B,IAAJ,CAASoC,KAAT,CAAe,sBAAf,EAAuC,CAAvC,CAAhB;AACA,mBAAKnC,IAAL,CAAUE,GAAV,GAAgBuB,IAAI1B,IAAJ,CAASoC,KAAT,CAAe,sBAAf,EAAuC,CAAvC,CAAhB;AACA,mBAAKnC,IAAL,CAAUK,UAAV,GAAuBoB,IAAI1B,IAAJ,CAASoC,KAAT,CAAe,kCAAf,EAAmD,CAAnD,CAAvB;AACD;AACD,cAAIV,IAAIe,OAAJ,CAAY,YAAZ,CAAJ,EAA+B;AAC7Bf,gBAAIe,OAAJ,CAAY,YAAZ,EAA0BC,OAA1B,CAAkC,gBAAQ;AACxC,kBAAI,yBAAyBC,IAAzB,CAA8BC,IAA9B,CAAJ,EAAyC;AACvC,uBAAK3C,IAAL,CAAUO,eAAV,GAA4BoC,KAAKR,KAAL,CAAW,SAAX,EAAsB,CAAtB,CAA5B;AACD,eAFD,MAEO,IAAI,SAASO,IAAT,CAAcC,IAAd,CAAJ,EAAyB;AAC9B,uBAAK3C,IAAL,CAAUE,GAAV,GAAgByC,KAAKR,KAAL,CAAW,SAAX,EAAsB,CAAtB,CAAhB;AACD,eAFM,MAEA,IAAI,SAASO,IAAT,CAAcC,IAAd,CAAJ,EAAyB;AAC9B,uBAAK3C,IAAL,CAAUG,GAAV,GAAgBwC,KAAKR,KAAL,CAAW,SAAX,EAAsB,CAAtB,CAAhB;AACD;AACF,aARD;AASD;AACF,SAzBM,CAAP;AA0BD,OA3BM,EA2BJP,KA3BI,CA2BE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,MAAX;AACA,cAAMD,GAAN;AACD,OA/BM,CAAP;AAgCD;;;2BAEO;AAAA;;AACN,aAAOb,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,yBAAe,OAAK/B,IAAL,CAAUK,UADd;AAEX,kBAAQ,OAAKL,IAAL,CAAUI,IAFP;AAGX,eAAK,CAAC,IAAIwC,IAAJ;AAHK,SAAb;AAKA,YAAI7C,OAAO;AACT8C,uBAAa,OAAKC,cAAL;AADJ,SAAX;AAGA,eAAO,OAAKhC,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,OAAKV,IAAL,CAAUqC,aAFG;AAGlBhB,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAKzB,IAAL,CAAUI,IAAV,GAAiBL,KAAKmD,IAAL,IAAa,OAAKlD,IAAL,CAAUI,IAAxC;AACA,iBAAK+C,aAAL,CAAmBpD,IAAnB;AACAqD,iBAAOC,MAAP,CAAc,OAAKzC,IAAnB,EAAyBb,KAAKuD,IAA9B;AACA,iBAAOvD,IAAP;AACD,SAZM,CAAP;AAaD,OAtBM,EAsBJ6B,KAtBI,CAsBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,SAAX;AACA,cAAMD,GAAN;AACD,OA1BM,CAAP;AA2BD;;;iCAEa0B,E,EAAI;AAAA;;AAChB,aAAOvC,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACXyB,uBAAa,OAAKxD,IAAL,CAAUK,UADZ;AAEXoD,gBAAM;AAFK,SAAb;AAIA,YAAI1D,OAAO;AACT,yBAAe,OAAK+C,cAAL,EADN;AAET,kBAAQS,KAAK,CAAL,GAAS,CAFR;AAGT,0BAAgB,OAAK3C,IAAL,CAAU,UAAV,CAHP;AAIT,wBAAc2C,MAAM,OAAK3C,IAAL,CAAU,UAAV,CAJX;AAKT,yBAAe;AALN,SAAX;AAOA,eAAO,OAAKE,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,OAAKV,IAAL,CAAUgD,qBAFG;AAGlB3B,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACD,SARM,CAAP;AASD,OArBM,EAqBJG,KArBI,CAqBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,UAAX;AACA,cAAMD,GAAN;AACD,OAzBM,CAAP;AA0BD;;;iCAEoB;AAAA;;AAAA,UAAT8B,GAAS,uEAAH,CAAG;;AACnB,aAAO3C,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,kBAAQ,OADG;AAEX,yBAAe,OAAK/B,IAAL,CAAUK,UAFd;AAGX,iBAAOsD,GAHI;AAIX,kBAAQ,OAAK3D,IAAL,CAAUI,IAJP;AAKX,eAAK,CAAC,IAAIwC,IAAJ;AALK,SAAb;AAOA,eAAO,OAAK9B,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,OAAKV,IAAL,CAAUkD,mBAFG;AAGlB7B,kBAAQA;AAHU,SAAb,EAIJb,IAJI,CAIC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;;AAEA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OAlBM,EAkBJ6B,KAlBI,CAkBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,SAAX;AACA,cAAMD,GAAN;AACD,OAtBM,CAAP;AAuBD;;;oCAEgBgC,Q,EAAU;AAAA;;AACzB,aAAO7C,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,yBAAe,OAAK/B,IAAL,CAAUK,UADd;AAEX,kBAAQ,IAFG;AAGX,eAAK,CAAC,IAAIuC,IAAJ,EAHK;AAIX,kBAAQ;AAJG,SAAb;AAMA,YAAI7C,OAAO;AACT,yBAAe,OAAK+C,cAAL,EADN;AAET,mBAASe,SAASC,MAFT;AAGT,kBAAQD;AAHC,SAAX;AAKA,eAAO,OAAK/C,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,OAAKV,IAAL,CAAUqD,wBAFG;AAGlBhC,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;;AAEA,iBAAO1B,KAAKiE,WAAZ;AACD,SAVM,CAAP;AAWD,OAvBM,EAuBJpC,KAvBI,CAuBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,WAAX;AACA,cAAMD,GAAN;AACD,OA3BM,CAAP;AA4BD;;;+BAEWoC,I,EAAM;AAAA;;AAChB,aAAOjD,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC+C,eAAOA,QAAQ;AACb,kBAAQ,iBADK;AAEb,kBAAQ;AACN,uBAAW,CAAC;AACV,sBAAQ,OADE;AAEV,wBAAU,KAFA;AAGV,sBAAQ,CAAC,IAAIrB,IAAJ;AAHC,aAAD;AADL;AAFK,SAAf;AAUAqB,eAAOC,KAAKC,SAAL,CAAeF,IAAf,CAAP;AACA,YAAIlC,SAAS;AACX,yBAAe,OAAK/B,IAAL,CAAUK,UADd;AAEX,iBAAO,KAFI;AAGX,kBAAQ;AAHG,SAAb;AAKA,YAAIN,OAAO;AACT,yBAAe,OAAK+C,cAAL,EADN;AAET,mBAAS,CAFA;AAGT,kBAAQ,CAAC;AACP,oBAAQmB,IADD;AAEP,oBAAQ;AAFD,WAAD;AAHC,SAAX;AAQA,eAAO,OAAKnD,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,OAAKV,IAAL,CAAU0D,eAFG;AAGlBrC,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,CAAP;AAMD,OA/BM,EA+BJ6B,KA/BI,CA+BE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OAnCM,CAAP;AAoCD;;;gCAEY;AAAA;;AACX,aAAOb,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,eAAK,CAAC,IAAIa,IAAJ,EADK;AAEX,iBAAO,OAAK5C,IAAL,CAAUG,GAFN;AAGX,iBAAO,OAAKH,IAAL,CAAUE,GAHN;AAIX,kBAAQ,OAAKF,IAAL,CAAUI,IAJP;AAKX,sBAAY,wBALD;AAMX,qBAAW,OAAKJ,IAAL,CAAUM;AANV,SAAb;AAQA,eAAO,OAAKQ,OAAL,CAAa;AAClBK,kBAAQ,KADU;AAElBC,eAAK,OAAKV,IAAL,CAAU2D,aAFG;AAGlBtC,kBAAQA;AAHU,SAAb,EAIJb,IAJI,CAIC,eAAO;AACb,cAAII,SAAS;AACXgD,uBAAW;AADA,WAAb;;AAIA,cAAI;AACF;AACA9C,iBAAKC,IAAI1B,IAAT;AACD,WAHD,CAGE,OAAOwE,EAAP,EAAW;AACXjD,mBAAOgD,SAAP,GAAmB,EAACE,SAAS,GAAV,EAAeC,UAAU,GAAzB,EAAnB;AACD;AACD,uBAAO/C,KAAP,CAAaJ,OAAOgD,SAAP,CAAiBE,OAA9B,EAAuC,OAAK9D,IAAL,CAAUgE,qBAAjD,EAAwEjD,GAAxE;;AAEA,iBAAOH,OAAOgD,SAAP,CAAiBG,QAAxB;AACD,SAlBM,CAAP;AAmBD,OA5BM,EA4BJ7C,KA5BI,CA4BE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,MAAX;AACA,cAAMD,GAAN;AACD,OAhCM,CAAP;AAiCD;;;2BAEO;AAAA;;AACN,aAAOb,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,iBAAO,QAAK/B,IAAL,CAAUG,GADN;AAEX,kBAAQ,QAAKH,IAAL,CAAUI,IAFP;AAGX,yBAAe,QAAKJ,IAAL,CAAUK,UAHd;AAIX,kBAAQ;AAJG,SAAb;AAMA,YAAIN,OAAO;AACT,yBAAe,QAAK+C,cAAL,EADN;AAET,qBAAW,QAAK9C,IAAL,CAAUQ,OAFZ;AAGT,gBAAM,CAAC,IAAIoC,IAAJ;AAHE,SAAX;AAKA,eAAO,QAAK9B,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUiE,aAFG;AAGlB5C,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;;AAEA,kBAAK0B,aAAL,CAAmBpD,IAAnB;AACA,kBAAKC,IAAL,CAAUI,IAAV,GAAiBL,KAAKmD,IAAL,IAAa,QAAKlD,IAAL,CAAUI,IAAxC;AACA,iBAAOL,IAAP;AACD,SAZM,CAAP;AAaD,OAzBM,EAyBJ6B,KAzBI,CAyBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,SAAX;AACA,cAAMD,GAAN;AACD,OA7BM,CAAP;AA8BD;;;kCAEc9B,I,EAAM;AACnB,UAAIA,KAAK6E,OAAT,EAAkB;AAChB,aAAK5E,IAAL,CAAUQ,OAAV,GAAoBT,KAAK6E,OAAzB;AACD;AACD,UAAI7E,KAAK8E,YAAT,EAAuB;AACrB,YAAIC,cAAc,EAAlB;AACA,aAAK,IAAIC,IAAIhF,KAAK8E,YAAL,CAAkBpE,IAA1B,EAAgCuE,IAAI,CAApC,EAAuCC,IAAIF,EAAEjB,MAAlD,EAA0DmB,IAAID,CAA9D,EAAiEA,GAAjE,EAAsE;AACpEF,sBAAYI,IAAZ,CAAiBH,EAAEC,CAAF,EAAK,KAAL,IAAc,GAAd,GAAoBD,EAAEC,CAAF,EAAK,KAAL,CAArC;AACD;AACD,aAAKhF,IAAL,CAAUM,eAAV,GAA4BwE,YAAYK,IAAZ,CAAiB,GAAjB,CAA5B;AACD,OAND,MAMO,IAAI,CAAC,KAAKnF,IAAL,CAAUM,eAAX,IAA8BP,KAAK6E,OAAvC,EAAgD;AACrD,YAAIE,eAAc,EAAlB;AACA,aAAK,IAAIC,KAAIhF,KAAK6E,OAAL,CAAanE,IAArB,EAA2BuE,KAAI,CAA/B,EAAkCC,KAAIF,GAAEjB,MAA7C,EAAqDmB,KAAID,EAAzD,EAA4DA,IAA5D,EAAiE;AAC/DF,uBAAYI,IAAZ,CAAiBH,GAAEC,EAAF,EAAK,KAAL,IAAc,GAAd,GAAoBD,GAAEC,EAAF,EAAK,KAAL,CAArC;AACD;AACD,aAAKhF,IAAL,CAAUM,eAAV,GAA4BwE,aAAYK,IAAZ,CAAiB,GAAjB,CAA5B;AACD;AACF;;;6BAES;AAAA;;AACR,aAAOnE,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACXqD,oBAAU,CADC;AAEXC,gBAAM,CAFK;AAGXjF,gBAAM,QAAKJ,IAAL,CAAUI,IAHL;AAIXqD,gBAAM;;AAGR;AACA;AACA;AACA;AACA;AAXa,SAAb,CAYA,OAAO,QAAK3C,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAU4E,eAFG;AAGlBvD,kBAAQA;AAHU,SAAb,EAIJb,IAJI,CAIC,eAAO;AACb,iBAAO,MAAP;AACD,SANM,EAMJU,KANI,CAME,eAAO;AACd/B,gBAAMgC,GAAN;AACA,iBAAO,QAAP;AACD,SATM,CAAP;AAUD,OAvBM,CAAP;AAwBD;;;6BAES0D,G,EAAKhC,E,EAAI;AAAA;;AACjB,aAAOvC,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,yBAAe,QAAK/B,IAAL,CAAUK,UADd;AAEX,kBAAQ;AAFG,SAAb;AAIA,YAAImF,cAAc,2BAAlB;AACA,YAAIzF,OAAO;AACT,yBAAe,QAAK+C,cAAL,EADN;AAET,mBAAS,CAFA;AAGT,iBAAO;AACL,oBAAQ,QAAKpC,IAAL,CAAU+E,YADb;AAEL,uBAAWF,GAFN;AAGL,4BAAgB,QAAK3E,IAAL,CAAU,UAAV,CAHX;AAIL,0BAAc2C,EAJT;AAKL,uBAAWiC,WALN;AAML,2BAAeA;AANV;AAHE,SAAX;AAYA,eAAO,QAAK1E,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUgF,gBAFG;AAGlB3D,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OA5BM,EA4BJ6B,KA5BI,CA4BE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,UAAX;AACA,cAAMD,GAAN;AACD,OAhCM,CAAP;AAiCD;;;iCAEa8D,E,EAAIpC,E,EAAI;AAAA;;AACpB,aAAOvC,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,iBAAO,KADI;AAEX,yBAAe,QAAK/B,IAAL,CAAUK,UAFd;AAGX,kBAAQ;AAHG,SAAb;AAKA,YAAImF,cAAc,2BAAlB;AACA,YAAIzF,OAAO;AACT,yBAAe,QAAK+C,cAAL,EADN;AAET,mBAAS,CAFA;AAGT,iBAAO;AACL,oBAAQ,QAAKpC,IAAL,CAAUkF,gBADb;AAEL,yBAAa,CAFR;AAGL,4BAAgB,QAAKhF,IAAL,CAAU,UAAV,CAHX;AAIL,0BAAc2C,EAJT;AAKL,uBAAWiC,WALN;AAML,2BAAeA;AANV;AAHE,SAAX;;AAaA,YAAIG,GAAGE,OAAH,CAAW,GAAX,MAAoB,CAAxB,EAA2B;AACzB9F,eAAK+F,GAAL,CAASC,OAAT,GAAmBJ,EAAnB;AACD,SAFD,MAEO;AACL5F,eAAK+F,GAAL,CAASE,WAAT,GAAuBL,EAAvB;AACD;;AAED,eAAO,QAAK7E,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUuF,qBAFG;AAGlBlE,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OApCM,EAoCJ6B,KApCI,CAoCE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,UAAX;AACA,cAAMD,GAAN;AACD,OAxCM,CAAP;AAyCD;;AAED;;;;gCACaqE,I,EAAMC,Q,EAAUC,U,EAAY;AAAA;;AACvC,aAAOpF,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAImF,aAAJ;AAAA,YAAUhB,aAAV;AAAA,YAAgBiB,aAAhB;AAAA,YAAsBC,YAAtB;AAAA,YAA2BC,kBAA3B;AAAA,YAAsCzG,aAAtC;AACA,eAAO,IAAIiB,OAAJ,CAAY,UAACC,OAAD,EAAUwF,MAAV,EAAqB;AACtC,cAAK,OAAQC,IAAR,KAAkB,WAAlB,IAAiCR,KAAKS,WAAL,IAAoBD,IAAtD,IACD,OAAQE,IAAR,KAAkB,WAAlB,IAAiCV,KAAKS,WAAL,IAAoBC,IADxD,EAC+D;AAC7DP,mBAAOH,KAAKG,IAAL,IAAa,MAApB;AACAhB,mBAAOa,KAAKb,IAAZ;AACAiB,mBAAOJ,KAAKI,IAAZ;AACAvG,mBAAOmG,IAAP;AACA,mBAAOjF,SAAP;AACD,WAPD,MAOO,IAAI4F,OAAOC,QAAP,CAAgBZ,IAAhB,CAAJ,EAA2B;AAChC,gBAAI,CAACC,QAAL,EAAe;AACb,qBAAOM,OAAO,IAAIM,KAAJ,CAAU,OAAV,CAAP,CAAP;AACD;AACDV,mBAAOF,QAAP;AACAd,mBAAO,eAAK2B,MAAL,CAAYX,IAAZ,CAAP;AACAC,mBAAOJ,KAAKpC,MAAZ;AACA/D,mBAAOmG,IAAP;AACA,mBAAOjF,SAAP;AACD,WATM,MASA,IAAIiF,KAAKe,QAAT,EAAmB;AACxB,gBAAI,CAACf,KAAKgB,IAAN,IAAc,CAACf,QAAnB,EAA6B;AAC3B,qBAAOM,OAAO,IAAIM,KAAJ,CAAU,OAAV,CAAP,CAAP;AACD;AACDV,mBAAO,eAAKc,QAAL,CAAcjB,KAAKgB,IAAL,IAAaf,QAA3B,CAAP;AACAd,mBAAO,eAAK2B,MAAL,CAAYX,IAAZ,CAAP;AACAH,iBAAKkB,IAAL,CAAU,kBAAG,UAACvF,GAAD,EAAMwF,MAAN,EAAiB;AAC5B,kBAAIxF,GAAJ,EAAS;AACP,uBAAO4E,OAAO5E,GAAP,CAAP;AACD;AACDyE,qBAAOe,OAAOvD,MAAd;AACA/D,qBAAOsH,MAAP;AACA,qBAAOpG,SAAP;AACD,aAPS,CAAV;AAQD;AACF,SAhCM,EAgCJC,IAhCI,CAgCC,YAAM;AACZqF,gBAAMF,KAAKlE,KAAL,CAAW,UAAX,CAAN;AACA,cAAIoE,GAAJ,EAAS;AACPA,kBAAMA,IAAI,CAAJ,EAAOe,WAAP,EAAN;AACD,WAFD,MAEO;AACLf,kBAAM,EAAN;AACD;;AAED,kBAAQA,GAAR;AACE,iBAAK,KAAL;AACA,iBAAK,MAAL;AACA,iBAAK,KAAL;AACA,iBAAK,KAAL;AACEC,0BAAY,KAAZ;AACA;AACF,iBAAK,KAAL;AACEA,0BAAY,OAAZ;AACA;AACF;AACEA,0BAAY,KAAZ;AAXJ;;AAcA,cAAIhB,cAAc,2BAAlB;;AAEA,cAAI+B,qBAAqBrD,KAAKC,SAAL,CAAe;AACtCtB,yBAAa,QAAKC,cAAL,EADyB;AAEtC0E,2BAAehC,WAFuB;AAGtCiC,sBAAUnB,IAH4B;AAItCoB,sBAAU,CAJ4B;AAKtCC,qBAASrB,IAL6B;AAMtCsB,uBAAW,CAN2B;AAOtCC,wBAAY,CAP0B;AAQtCC,0BAAc,QAAKlH,IAAL,CAAUmH,QARc;AAStCC,wBAAY5B,cAAc,QAAKxF,IAAL,CAAUmH;AATE,WAAf,CAAzB;;AAYA,cAAIE,OAAO,wBAAX;AACAA,eAAKC,MAAL,CAAY,MAAZ,EAAoB7B,IAApB;AACA4B,eAAKC,MAAL,CAAY,MAAZ,EAAoB7C,IAApB;AACA4C,eAAKC,MAAL,CAAY,kBAAZ,EAAgC,IAAItF,IAAJ,GAAWuF,WAAX,EAAhC;AACAF,eAAKC,MAAL,CAAY,MAAZ,EAAoB5B,IAApB;AACA2B,eAAKC,MAAL,CAAY,WAAZ,EAAyB1B,SAAzB;AACAyB,eAAKC,MAAL,CAAY,oBAAZ,EAAkCX,kBAAlC;AACAU,eAAKC,MAAL,CAAY,mBAAZ,EAAiC,QAAKlI,IAAL,CAAUO,eAA3C;AACA0H,eAAKC,MAAL,CAAY,aAAZ,EAA2BE,UAAU,QAAKpI,IAAL,CAAUK,UAApB,CAA3B;AACA4H,eAAKC,MAAL,CAAY,UAAZ,EAAwBnI,IAAxB,EAA8B;AAC5BoG,sBAAUE,IADkB;AAE5BgC,yBAAahD,IAFe;AAG5BiD,yBAAahC;AAHe,WAA9B;AAKA,iBAAO,IAAItF,OAAJ,CAAY,UAACC,OAAD,EAAUwF,MAAV,EAAqB;AACtC,4CAA0B;AACxB,qBAAOxF,QAAQ;AACblB,sBAAMkI,IADO;AAEbzF,yBAAS;AAFI,eAAR,CAAP;AAID,aALD,MAKO;AACLyF,mBAAKb,IAAL,CAAU,kBAAG,UAACvF,GAAD,EAAMwF,MAAN,EAAiB;AAC5B,oBAAIxF,GAAJ,EAAS;AACP,yBAAO4E,OAAO5E,GAAP,CAAP;AACD;AACD,uBAAOZ,QAAQ;AACblB,wBAAMsH,MADO;AAEb7E,2BAASyF,KAAKM,UAAL;AAFI,iBAAR,CAAP;AAID,eARS,CAAV;AASD;AACF,WAjBM,CAAP;AAkBD,SApGM,EAoGJrH,IApGI,CAoGC,gBAAQ;AACd,cAAIa,SAAS;AACXyG,eAAG;AADQ,WAAb;;AAIA,iBAAO,QAAK1H,OAAL,CAAa;AAClBK,oBAAQ,MADU;AAElBC,iBAAK,QAAKV,IAAL,CAAU+H,oBAFG;AAGlBjG,qBAASzC,KAAKyC,OAHI;AAIlBT,oBAAQA,MAJU;AAKlBhC,kBAAMA,KAAKA;AALO,WAAb,CAAP;AAOD,SAhHM,EAgHJmB,IAhHI,CAgHC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,cAAI2I,UAAU3I,KAAKgG,OAAnB;AACA,uBAAO4C,EAAP,CAAUD,OAAV,EAAmBjH,GAAnB;;AAEA,iBAAO;AACL4E,kBAAMA,IADD;AAELC,kBAAMA,IAFD;AAGLC,iBAAKA,GAHA;AAILC,uBAAWA,SAJN;AAKLkC,qBAASA;AALJ,WAAP;AAOD,SA5HM,CAAP;AA6HD,OA/HM,EA+HJ9G,KA/HI,CA+HE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,UAAX;AACA,cAAMD,GAAN;AACD,OAnIM,CAAP;AAoID;;;4BAEQ6G,O,EAASnF,E,EAAI;AAAA;;AACpB,aAAOvC,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,yBAAe,QAAK/B,IAAL,CAAUK,UADd;AAEX,iBAAO,OAFI;AAGX,eAAK,MAHM;AAIX,kBAAQ;AAJG,SAAb;AAMA,YAAImF,cAAc,2BAAlB;AACA,YAAIzF,OAAO;AACT,yBAAe,QAAK+C,cAAL,EADN;AAET,mBAAS,CAFA;AAGT,iBAAO;AACL,oBAAQ,QAAKpC,IAAL,CAAUkI,aADb;AAEL,uBAAWF,OAFN;AAGL,4BAAgB,QAAK9H,IAAL,CAAUmH,QAHrB;AAIL,0BAAcxE,EAJT;AAKL,uBAAWiC,WALN;AAML,2BAAeA;AANV;AAHE,SAAX;AAYA,eAAO,QAAK1E,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUmI,mBAFG;AAGlB9G,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OA9BM,EA8BJ6B,KA9BI,CA8BE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OAlCM,CAAP;AAmCD;;;8BAEU6G,O,EAASnF,E,EAAI;AAAA;;AACtB,aAAOvC,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,yBAAe,QAAK/B,IAAL,CAAUK,UADd;AAEX,iBAAO,OAFI;AAGX,eAAK,MAHM;AAIX,kBAAQ;AAJG,SAAb;AAMA,YAAImF,cAAc,2BAAlB;AACA,YAAIzF,OAAO;AACT,yBAAe,QAAK+C,cAAL,EADN;AAET,mBAAS,CAFA;AAGT,iBAAO;AACL,oBAAQ,QAAKpC,IAAL,CAAUoI,aADb;AAEL,uBAAWJ,OAFN;AAGL,4BAAgB,QAAK9H,IAAL,CAAUmH,QAHrB;AAIL,0BAAcxE,EAJT;AAKL,uBAAWiC,WALN;AAML,2BAAeA;AANV;AAHE,SAAX;AAYA,eAAO,QAAK1E,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUqI,qBAFG;AAGlBhH,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OA9BM,EA8BJ6B,KA9BI,CA8BE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OAlCM,CAAP;AAmCD;;;4BAEQ6G,O,EAASrC,I,EAAMC,I,EAAMC,G,EAAKhD,E,EAAI;AAAA;;AACrC,aAAOvC,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,yBAAe,QAAK/B,IAAL,CAAUK,UADd;AAEX,iBAAO,OAFI;AAGX,eAAK,MAHM;AAIX,kBAAQ;AAJG,SAAb;AAMA,YAAImF,cAAc,2BAAlB;AACA,YAAIzF,OAAO;AACT,yBAAe,QAAK+C,cAAL,EADN;AAET,mBAAS,CAFA;AAGT,iBAAO;AACL,oBAAQ,QAAKpC,IAAL,CAAUsI,iBADb;AAEL,oFAAkE3C,IAAlE,8HAA+LC,IAA/L,6BAA2NoC,OAA3N,4BAAyPnC,GAAzP,uDAFK;AAGL,4BAAgB,QAAK3F,IAAL,CAAUmH,QAHrB;AAIL,0BAAcxE,EAJT;AAKL,uBAAWiC,WALN;AAML,2BAAeA;AANV;AAHE,SAAX;AAYA,eAAO,QAAK1E,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUuI,mBAFG;AAGlBlH,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OA9BM,EA8BJ6B,KA9BI,CA8BE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OAlCM,CAAP;AAmCD;;;+BAEW0D,G,EAAKhC,E,EAAI;AAAA;;AACnB,aAAOvC,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,yBAAe,QAAK/B,IAAL,CAAUK,UADd;AAEX,iBAAO,OAFI;AAGX,eAAK,MAHM;AAIX,kBAAQ;AAJG,SAAb;AAMA,YAAImF,cAAc,2BAAlB;AACA,YAAIzF,OAAO;AACT,yBAAe,QAAK+C,cAAL,EADN;AAET,mBAAS,CAFA;AAGT,iBAAO;AACL,oBAAQyC,IAAI2D,OADP;AAEL,uBAAW,EAFN;AAGL,uBAAW3D,IAAI4D,OAAJ,CAAYC,OAAZ,CAAoB,OAApB,EAA6B,GAA7B,EAAkCA,OAAlC,CAA0C,OAA1C,EAAmD,GAAnD,CAHN;AAIL,4BAAgB,QAAKxI,IAAL,CAAUmH,QAJrB;AAKL,0BAAcxE,EALT;AAML,uBAAWiC,WANN;AAOL,2BAAeA;AAPV;AAHE,SAAX;AAaA,YAAIpE,YAAJ;AAAA,YAASmB,WAAT;AACA,gBAAQgD,IAAI2D,OAAZ;AACE,eAAK,QAAKxI,IAAL,CAAU+E,YAAf;AACErE,kBAAM,QAAKV,IAAL,CAAUgF,gBAAhB;AACA,gBAAIH,IAAI8D,UAAJ,KAAmB,QAAK3I,IAAL,CAAU4I,gBAAjC,EAAmD;AACjDvJ,mBAAK+F,GAAL,CAASyD,IAAT,GAAgB,QAAK7I,IAAL,CAAU4I,gBAA1B;AACAvJ,mBAAK+F,GAAL,CAASqD,OAAT,GAAmB5D,IAAIiE,UAAJ,CAAeJ,OAAf,CAAuB,OAAvB,EAAgC,GAAhC,EAAqCA,OAArC,CAA6C,OAA7C,EAAsD,GAAtD,CAAnB;AACD;AACD;AACF,eAAK,QAAK1I,IAAL,CAAUkI,aAAf;AACExH,kBAAM,QAAKV,IAAL,CAAUmI,mBAAhB;AACA;AACF,eAAK,QAAKnI,IAAL,CAAUkF,gBAAf;AACExE,kBAAM,QAAKV,IAAL,CAAUuF,qBAAhB;AACAlE,mBAAOO,GAAP,GAAa,KAAb;AACAvC,iBAAK+F,GAAL,CAASE,WAAT,GAAuBT,IAAI4D,OAAJ,CAAYC,OAAZ,CAAoB,qCAApB,EAA2D,IAA3D,CAAvB;AACA,gBAAI,CAACrJ,KAAK+F,GAAL,CAASE,WAAd,EAA2B;AACzB,oBAAM,IAAIe,KAAJ,CAAU,UAAV,CAAN;AACD;AACDhH,iBAAK+F,GAAL,CAAS2D,SAAT,GAAqB,CAArB;AACA1J,iBAAK2J,KAAL,GAAa,CAAb;AACA,mBAAO3J,KAAK+F,GAAL,CAASC,OAAhB;AACA,mBAAOhG,KAAK+F,GAAL,CAASqD,OAAhB;AACA;AACF,eAAK,QAAKzI,IAAL,CAAUiJ,kBAAf;AACA,eAAK,QAAKjJ,IAAL,CAAUoI,aAAf;AACE1H,kBAAM,QAAKV,IAAL,CAAUqI,qBAAhB;AACAhJ,iBAAK+F,GAAL,CAASyD,IAAT,GAAgB,QAAK7I,IAAL,CAAUoI,aAA1B;AACA;AACF,eAAK,QAAKpI,IAAL,CAAUkJ,WAAf;AACExI,kBAAM,QAAKV,IAAL,CAAUuI,mBAAhB;AACAlJ,iBAAK+F,GAAL,CAASyD,IAAT,GAAgBhE,IAAIsE,UAApB;AACA9J,iBAAK+F,GAAL,CAASqD,OAAT,GAAmBpJ,KAAK+F,GAAL,CAASqD,OAAT,CAAiBC,OAAjB,CACjB,uFADiB,SAEZ7D,IAAIQ,OAFQ,QAAnB;AAGA;AACF;AACE,kBAAM,IAAIgB,KAAJ,CAAU,aAAV,CAAN;AApCJ;AAsCA,eAAO,QAAKjG,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAKA,GAFa;AAGlBW,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OAtEM,EAsEJ6B,KAtEI,CAsEE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OA1EM,CAAP;AA2ED;;;8BAEUiI,K,EAAO;AAAA;;AAChB,aAAO9I,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACXgI,iBAAOD,KADI;AAEX1J,gBAAM,QAAKJ,IAAL,CAAUI,IAFL;AAGXiF,gBAAM;AAHK,SAAb;;AAMA,eAAO,QAAKvE,OAAL,CAAa;AAClBK,kBAAQ,KADU;AAElBC,eAAK,QAAKV,IAAL,CAAUsJ,kBAFG;AAGlBjI,kBAAQA,MAHU;AAIlBkI,wBAAc;AAJI,SAAb,EAKJ/I,IALI,CAKC,eAAO;AACb,iBAAO;AACLnB,kBAAM0B,IAAI1B,IADL;AAELsF,kBAAM5D,IAAIe,OAAJ,CAAY,cAAZ;AAFD,WAAP;AAID,SAVM,CAAP;AAWD,OAlBM,EAkBJZ,KAlBI,CAkBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,WAAX;AACA,cAAMD,GAAN;AACD,OAtBM,CAAP;AAuBD;;;6BAESiI,K,EAAO;AAAA;;AACf,aAAO9I,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACXgI,iBAAOD,KADI;AAEX1J,gBAAM,QAAKJ,IAAL,CAAUI;AAFL,SAAb;;AAKA,eAAO,QAAKU,OAAL,CAAa;AAClBK,kBAAQ,KADU;AAElBC,eAAK,QAAKV,IAAL,CAAUwJ,iBAFG;AAGlB1H,mBAAS;AACP,qBAAS;AADF,WAHS;AAMlBT,kBAAQA,MANU;AAOlBkI,wBAAc;AAPI,SAAb,EAQJ/I,IARI,CAQC,eAAO;AACb,iBAAO;AACLnB,kBAAM0B,IAAI1B,IADL;AAELsF,kBAAM5D,IAAIe,OAAJ,CAAY,cAAZ;AAFD,WAAP;AAID,SAbM,CAAP;AAcD,OApBM,EAoBJZ,KApBI,CAoBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OAxBM,CAAP;AAyBD;;;6BAESiI,K,EAAO;AAAA;;AACf,aAAO9I,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACXgI,iBAAOD,KADI;AAEX1J,gBAAM,QAAKJ,IAAL,CAAUI;AAFL,SAAb;;AAKA,eAAO,QAAKU,OAAL,CAAa;AAClBK,kBAAQ,KADU;AAElBC,eAAK,QAAKV,IAAL,CAAUyJ,iBAFG;AAGlBpI,kBAAQA,MAHU;AAIlBkI,wBAAc;AAJI,SAAb,EAKJ/I,IALI,CAKC,eAAO;AACb,iBAAO;AACLnB,kBAAM0B,IAAI1B,IADL;AAELsF,kBAAM5D,IAAIe,OAAJ,CAAY,cAAZ;AAFD,WAAP;AAID,SAVM,CAAP;AAWD,OAjBM,EAiBJZ,KAjBI,CAiBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OArBM,CAAP;AAsBD;;;+BAEWuI,U,EAAY;AAAA;;AACtB,aAAOpJ,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIE,MAAM,QAAKV,IAAL,CAAU2J,MAAV,GAAmBD,UAA7B;AACA,eAAO,QAAKtJ,OAAL,CAAa;AAClBK,kBAAQ,KADU;AAElBC,eAAKA,GAFa;AAGlB6I,wBAAc;AAHI,SAAb,EAIJ/I,IAJI,CAIC,eAAO;AACb,iBAAO;AACLnB,kBAAM0B,IAAI1B,IADL;AAELsF,kBAAM5D,IAAIe,OAAJ,CAAY,cAAZ;AAFD,WAAP;AAID,SATM,CAAP;AAUD,OAZM,EAYJZ,KAZI,CAYE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OAhBM,CAAP;AAiBD;;;2BAEOiG,Y,EAAc/B,O,EAASuE,Q,EAAU;AAAA;;AACvC,aAAOtJ,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACXwI,kBAAQzC,YADG;AAEX0C,mBAASzE,OAFE;AAGXI,oBAAUmE,QAHC;AAIXG,oBAAU,QAAK7J,IAAL,CAAUmH,QAJT;AAKXvE,uBAAa,QAAKxD,IAAL,CAAUK,UALZ;AAMXqK,6BAAmB,QAAK1K,IAAL,CAAUO;AANlB,SAAb;AAQA,eAAO,QAAKO,OAAL,CAAa;AAClBK,kBAAQ,KADU;AAElBC,eAAK,QAAKV,IAAL,CAAUiK,sBAFG;AAGlB5I,kBAAQA,MAHU;AAIlBkI,wBAAc;AAJI,SAAb,EAKJ/I,IALI,CAKC,eAAO;AACb,iBAAO;AACLnB,kBAAM0B,IAAI1B,IADL;AAELsF,kBAAM5D,IAAIe,OAAJ,CAAY,cAAZ;AAFD,WAAP;AAID,SAVM,CAAP;AAWD,OApBM,EAoBJZ,KApBI,CAoBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OAxBM,CAAP;AAyBD;;;+BAEWkG,Q,EAAU6C,M,EAAQ;AAAA;;AAC5B,aAAO5J,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,yBAAe,QAAK/B,IAAL,CAAUK,UADd;AAEX,kBAAQ;AAFG,SAAb;AAIA,YAAIN,OAAO;AACT,yBAAe,QAAK+C,cAAL,EADN;AAET,oBAAU,CAFD;AAGT,gCAAsB,CAHb;AAIT,4BAAkB,CAAC;AACjB,qBAASiF,QADQ;AAEjB,gCAAoB6C;AAFH,WAAD,CAJT;AAQT,2BAAiB,EARR;AAST,4BAAkB,CATT;AAUT,uBAAa,CAAC,EAAD,CAVJ;AAWT,kBAAQ,QAAK5K,IAAL,CAAUI;AAXT,SAAX;AAaA,eAAO,QAAKU,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUmK,mBAFG;AAGlB9I,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OA5BM,EA4BJ6B,KA5BI,CA4BE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,UAAX;AACA,cAAMD,GAAN;AACD,OAhCM,CAAP;AAiCD;;AAEC;;;;;;;;;8BAMSkG,Q,EAA+C;AAAA,UAArC+C,OAAqC,uEAA3B,OAAO,KAAKlK,IAAL,CAAUmK,QAAU;;AACxD,UAAIhJ,SAAS;AACX,uBAAe,KAAK/B,IAAL,CAAUK,UADd;AAEX,gBAAQ;AAFG,OAAb;;AAKA,UAAIN,OAAO;AACT,uBAAe,KAAK+C,cAAL,EADN;AAET,kBAAU,CAFD;AAGT,8BAAsB,CAHb;AAIT,0BAAkB,CAAC;AACjB,mBAASiF,QADQ;AAEjB,8BAAoB;AAFH,SAAD,CAJT;AAQT,yBAAiB+C,OARR;AAST,0BAAkB,CATT;AAUT,qBAAa,CAAC,EAAD,CAVJ;AAWT,gBAAQ,KAAK9K,IAAL,CAAUI;AAXT,OAAX;;AAcA,aAAO,KAAKU,OAAL,CAAa;AAClBK,gBAAQ,MADU;AAElBC,aAAK,KAAKV,IAAL,CAAUmK,mBAFG;AAGlB9I,gBAAQA,MAHU;AAIlBhC,cAAMA;AAJY,OAAb,EAKJmB,IALI,CAKC,eAAO;AACb,YAAInB,OAAO0B,IAAI1B,IAAf;AACA,qBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,eAAO1B,IAAP;AACD,OATM,EASJ6B,KATI,CASE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,QAAX;AACA,cAAMD,GAAN;AACD,OAbM,CAAP;AAcD;;AAED;AACA;AACA;AACA;AACA;AACA;;;;mCACgBmJ,K,EAAOC,U,EAAY;AAAA;;AACjC,aAAOjK,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,yBAAe,QAAK/B,IAAL,CAAUK,UADd;AAEX,kBAAQ,OAFG;AAGX,eAAK,CAAC,IAAIuC,IAAJ;AAHK,SAAb;AAKA,YAAI7C,OAAO;AACT8C,uBAAa,QAAKC,cAAL,EADJ;AAEToI,uBAAaD,WAAWnH,MAFf;AAGTmH,sBAAYA,UAHH;AAITD,iBAAOA;AAJE,SAAX;AAMA,eAAO,QAAKlK,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUyK,uBAFG;AAGlBpJ,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OAtBM,EAsBJ6B,KAtBI,CAsBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,OAAX;AACA,cAAMD,GAAN;AACD,OA1BM,CAAP;AA2BD;;AAED;;;;mCACgBuJ,gB,EAAkBH,U,EAAY3I,G,EAAK;AAAA;;AACjD,aAAOtB,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACXO,eAAKA;AADM,SAAb;AAGA,YAAIvC,OAAO;AACT8C,uBAAa,QAAKC,cAAL,EADJ;AAETuI,wBAAcD;AAFL,SAAX;AAIA,YAAI9I,QAAQ,WAAZ,EAAyB;AACvBvC,eAAKuL,aAAL,GAAqBL,WAAWM,QAAX,EAArB;AACD,SAFD,MAEO,IAAIjJ,QAAQ,WAAZ,EAAyB;AAC9BvC,eAAKyL,aAAL,GAAqBP,WAAWM,QAAX,EAArB;AACD,SAFM,MAEA,IAAIjJ,QAAQ,cAAZ,EAA4B;AACjCvC,eAAK0L,gBAAL,GAAwBR,WAAWM,QAAX,EAAxB;AACD;AACD,eAAO,QAAKzK,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUgL,uBAFG;AAGlB3J,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OAzBM,EAyBJ6B,KAzBI,CAyBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,YAAX;AACA,cAAMD,GAAN;AACD,OA7BM,CAAP;AA8BD;;AAED;AACA;;;;0BACOkG,Q,EAAU4D,E,EAAIC,U,EAAY;AAAA;;AAC/B,aAAO5K,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACXyB,uBAAa,QAAKxD,IAAL,CAAUK;AADZ,SAAb;AAGA,YAAIN,OAAO;AACT8C,uBAAa,QAAKC,cAAL,EADJ;AAET+I,iBAAO,CAFE;AAGTF,cAAIA,EAHK;AAITC,sBAAYA,UAJH;AAKT7D,oBAAUA;AALD,SAAX;AAOA,eAAO,QAAKjH,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUoL,cAFG;AAGlB/J,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OArBM,EAqBJ6B,KArBI,CAqBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,WAAX;AACA,cAAMD,GAAN;AACD,OAzBM,CAAP;AA0BD;;;qCAEiBkG,Q,EAAU6D,U,EAAY;AAAA;;AACtC,aAAO5K,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACXyB,uBAAa,QAAKxD,IAAL,CAAUK,UADZ;AAEX,kBAAQ;AAFG,SAAb;AAIA,YAAIN,OAAO;AACT8C,uBAAa,QAAKC,cAAL,EADJ;AAET+I,iBAAO,CAFE;AAGTD,sBAAYA,UAHH;AAIT7D,oBAAUA;AAJD,SAAX;AAMA,eAAO,QAAKjH,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUoL,cAFG;AAGlB/J,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SATM,CAAP;AAUD,OArBM,EAqBJ6B,KArBI,CAqBE,eAAO;AACd/B,cAAMgC,GAAN;AACAA,YAAIC,IAAJ,GAAW,UAAX;AACA,cAAMD,GAAN;AACD,OAzBM,CAAP;AA0BD;;;uCAEmBuJ,gB,EAAkBW,O,EAAS;AAAA;;AAC7C,aAAO/K,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAIa,SAAS;AACX,iBAAO;AADI,SAAb;AAGA,YAAIhC,OAAO;AACT8C,uBAAa,QAAKC,cAAL,EADJ;AAETuI,wBAAcD,gBAFL;AAGTY,oBAAUD;AAHD,SAAX;AAKA,eAAO,QAAKjL,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAUgL,uBAFG;AAGlB3J,kBAAQA,MAHU;AAIlBhC,gBAAMA;AAJY,SAAb,EAKJmB,IALI,CAKC,eAAO;AACb+K,kBAAQC,GAAR,CAAYhI,KAAKC,SAAL,CAAe1C,GAAf,CAAZ;AACA,cAAI1B,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACD,SATM,CAAP;AAUD,OAnBM,EAmBJG,KAnBI,CAmBE,eAAO;AACd/B,cAAMgC,GAAN;AACA,cAAM,IAAIkF,KAAJ,CAAU,QAAV,CAAN;AACD,OAtBM,CAAP;AAuBD;;;8BAEU+C,K,EAAO1D,U,EAAY;AAAA;;AAC5B,aAAOpF,QAAQC,OAAR,GAAkBC,IAAlB,CAAuB,YAAM;AAClC,YAAInB,OAAO;AACT8C,uBAAa,QAAKC,cAAL,EADJ;AAETqJ,oBAAUrC,KAFD;AAGT9B,sBAAY5B,UAHH;AAITgG,uBAAa;AAJJ,SAAX;AAMA,eAAO,QAAKtL,OAAL,CAAa;AAClBK,kBAAQ,MADU;AAElBC,eAAK,QAAKV,IAAL,CAAU2L,kBAFG;AAGlBtM,gBAAMA;AAHY,SAAb,EAIJmB,IAJI,CAIC,eAAO;AACb,cAAInB,OAAO0B,IAAI1B,IAAf;AACA,uBAAO2B,KAAP,CAAa3B,KAAKiD,YAAL,CAAkBC,GAA/B,EAAoC,CAApC,EAAuCxB,GAAvC;AACA,iBAAO1B,IAAP;AACD,SARM,CAAP;AASD,OAhBM,EAgBJ6B,KAhBI,CAgBE,eAAO;AACd/B,cAAMgC,GAAN;AACA,cAAM,IAAIkF,KAAJ,CAAU,QAAV,CAAN;AACD,OAnBM,CAAP;AAoBD;;;qCAEiB;AAChB,aAAO;AACLuF,aAAKC,SAAS,KAAKvM,IAAL,CAAUE,GAAnB,CADA;AAELsM,aAAK,KAAKxM,IAAL,CAAUG,GAFV;AAGLsM,cAAM,KAAKzM,IAAL,CAAUI,IAHX;AAILsM,kBAAU;AAJL,OAAP;AAMD;;;wBAxpCc;AACb,aAAO;AACL1M,cAAM,KAAKA,IADN;AAELU,cAAM,KAAKA,IAFN;AAGLC,gBAAQ,KAAKA,MAHR;AAILC,cAAM,KAAKA;AAJN,OAAP;AAMD,K;sBAEYb,I,EAAM;AAAA;;AACjBqD,aAAOuJ,IAAP,CAAY5M,IAAZ,EAAkB0C,OAAlB,CAA0B,eAAO;AAC/BW,eAAOC,MAAP,CAAc,QAAKuJ,GAAL,CAAd,EAAyB7M,KAAK6M,GAAL,CAAzB;AACD,OAFD;AAGD;;;;;;kBAxCkB9M,U","file":"core.js","sourcesContent":["import path from 'path'\nimport bl from 'bl'\nimport _debug from 'debug'\nimport FormData from 'form-data'\nimport mime from 'mime'\nimport {\n  getCONF,\n  Request,\n  isStandardBrowserEnv,\n  assert,\n  getClientMsgId,\n  getDeviceID\n} from './util'\n\nconst debug = _debug('core')\n\nexport default class WechatCore {\n\n  constructor (data) {\n    this.PROP = {\n      uuid: '',\n      uin: '',\n      sid: '',\n      skey: '',\n      passTicket: '',\n      formatedSyncKey: '',\n      webwxDataTicket: '',\n      syncKey: {\n        List: []\n      }\n    }\n    this.CONF = getCONF()\n    this.COOKIE = {}\n    this.user = {}\n    if (data) {\n      this.botData = data\n    }\n\n    this.request = new Request({\n      Cookie: this.COOKIE\n    })\n  }\n\n  get botData () {\n    return {\n      PROP: this.PROP,\n      CONF: this.CONF,\n      COOKIE: this.COOKIE,\n      user: this.user\n    }\n  }\n\n  set botData (data) {\n    Object.keys(data).forEach(key => {\n      Object.assign(this[key], data[key])\n    })\n  }\n\n  getUUID () {\n    return Promise.resolve().then(() => {\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_jsLogin\n      }).then(res => {\n        let window = {\n          QRLogin: {}\n        }\n        // res.data: \"window.QRLogin.code = xxx; ...\"\n        // eslint-disable-next-line\n        eval(res.data)\n        assert.equal(window.QRLogin.code, 200, res)\n\n        this.PROP.uuid = window.QRLogin.uuid\n        return window.QRLogin.uuid\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '获取UUID失败'\n      throw err\n    })\n  }\n\n  checkLogin () {\n    return Promise.resolve().then(() => {\n      let params = {\n        'tip': 0,\n        'uuid': this.PROP.uuid,\n        'loginicon': true\n      }\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_login,\n        params: params\n      }).then(res => {\n        let window = {}\n\n        // eslint-disable-next-line\n        eval(res.data)\n        assert.notEqual(window.code, 400, res)\n\n        if (window.code === 200) {\n          this.CONF = getCONF(window.redirect_uri.match(/(?:\\w+\\.)+\\w+/)[0])\n          this.rediUri = window.redirect_uri\n        } else if (window.code === 201 && window.userAvatar) {\n          // this.user.userAvatar = window.userAvatar\n        }\n        return window\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '获取手机确认登录信息失败'\n      throw err\n    })\n  }\n\n  login () {\n    return Promise.resolve().then(() => {\n      return this.request({\n        method: 'GET',\n        url: this.rediUri,\n        params: {\n          fun: 'new'\n        }\n      }).then(res => {\n        let pm = res.data.match(/<ret>(.*)<\\/ret>/)\n        if (pm && pm[1] === '0') {\n          this.PROP.skey = res.data.match(/<skey>(.*)<\\/skey>/)[1]\n          this.PROP.sid = res.data.match(/<wxsid>(.*)<\\/wxsid>/)[1]\n          this.PROP.uin = res.data.match(/<wxuin>(.*)<\\/wxuin>/)[1]\n          this.PROP.passTicket = res.data.match(/<pass_ticket>(.*)<\\/pass_ticket>/)[1]\n        }\n        if (res.headers['set-cookie']) {\n          res.headers['set-cookie'].forEach(item => {\n            if (/webwx.*?data.*?ticket/i.test(item)) {\n              this.PROP.webwxDataTicket = item.match(/=(.*?);/)[1]\n            } else if (/wxuin/i.test(item)) {\n              this.PROP.uin = item.match(/=(.*?);/)[1]\n            } else if (/wxsid/i.test(item)) {\n              this.PROP.sid = item.match(/=(.*?);/)[1]\n            }\n          })\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '登录失败'\n      throw err\n    })\n  }\n\n  init () {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'skey': this.PROP.skey,\n        'r': ~new Date()\n      }\n      let data = {\n        BaseRequest: this.getBaseRequest()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxinit,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        this.PROP.skey = data.SKey || this.PROP.skey\n        this.updateSyncKey(data)\n        Object.assign(this.user, data.User)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '微信初始化失败'\n      throw err\n    })\n  }\n\n  notifyMobile (to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        pass_ticket: this.PROP.passTicket,\n        lang: 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Code': to ? 1 : 3,\n        'FromUserName': this.user['UserName'],\n        'ToUserName': to || this.user['UserName'],\n        'ClientMsgId': getClientMsgId()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxstatusnotify,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '手机状态通知失败'\n      throw err\n    })\n  }\n\n  getContact (seq = 0) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'lang': 'zh_CN',\n        'pass_ticket': this.PROP.passTicket,\n        'seq': seq,\n        'skey': this.PROP.skey,\n        'r': +new Date()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxgetcontact,\n        params: params\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '获取通讯录失败'\n      throw err\n    })\n  }\n\n  batchGetContact (contacts) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'type': 'ex',\n        'r': +new Date(),\n        'lang': 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Count': contacts.length,\n        'List': contacts\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxbatchgetcontact,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n\n        return data.ContactList\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '批量获取联系人失败'\n      throw err\n    })\n  }\n\n  statReport (text) {\n    return Promise.resolve().then(() => {\n      text = text || {\n        'type': '[action-record]',\n        'data': {\n          'actions': [{\n            'type': 'click',\n            'action': '发送框',\n            'time': +new Date()\n          }]\n        }\n      }\n      text = JSON.stringify(text)\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'fun': 'new',\n        'lang': 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Count': 1,\n        'List': [{\n          'Text': text,\n          'Type': 1\n        }]\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxreport,\n        params: params,\n        data: data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '状态报告失败'\n      throw err\n    })\n  }\n\n  syncCheck () {\n    return Promise.resolve().then(() => {\n      let params = {\n        'r': +new Date(),\n        'sid': this.PROP.sid,\n        'uin': this.PROP.uin,\n        'skey': this.PROP.skey,\n        'deviceid': getDeviceID(),\n        'synckey': this.PROP.formatedSyncKey\n      }\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_synccheck,\n        params: params\n      }).then(res => {\n        let window = {\n          synccheck: {}\n        }\n\n        try {\n          // eslint-disable-next-line\n          eval(res.data)\n        } catch (ex) {\n          window.synccheck = {retcode: '0', selector: '0'}\n        }\n        assert.equal(window.synccheck.retcode, this.CONF.SYNCCHECK_RET_SUCCESS, res)\n\n        return window.synccheck.selector\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '同步失败'\n      throw err\n    })\n  }\n\n  sync () {\n    return Promise.resolve().then(() => {\n      let params = {\n        'sid': this.PROP.sid,\n        'skey': this.PROP.skey,\n        'pass_ticket': this.PROP.passTicket,\n        'lang': 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'SyncKey': this.PROP.syncKey,\n        'rr': ~new Date()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsync,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n\n        this.updateSyncKey(data)\n        this.PROP.skey = data.SKey || this.PROP.skey\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '获取新信息失败'\n      throw err\n    })\n  }\n\n  updateSyncKey (data) {\n    if (data.SyncKey) {\n      this.PROP.syncKey = data.SyncKey\n    }\n    if (data.SyncCheckKey) {\n      let synckeylist = []\n      for (let e = data.SyncCheckKey.List, o = 0, n = e.length; n > o; o++) {\n        synckeylist.push(e[o]['Key'] + '_' + e[o]['Val'])\n      }\n      this.PROP.formatedSyncKey = synckeylist.join('|')\n    } else if (!this.PROP.formatedSyncKey && data.SyncKey) {\n      let synckeylist = []\n      for (let e = data.SyncKey.List, o = 0, n = e.length; n > o; o++) {\n        synckeylist.push(e[o]['Key'] + '_' + e[o]['Val'])\n      }\n      this.PROP.formatedSyncKey = synckeylist.join('|')\n    }\n  }\n\n  logout () {\n    return Promise.resolve().then(() => {\n      let params = {\n        redirect: 1,\n        type: 0,\n        skey: this.PROP.skey,\n        lang: 'zh_CN'\n      }\n\n      // data加上会出错，不加data也能登出\n      // let data = {\n      //   sid: this.PROP.sid,\n      //   uin: this.PROP.uin\n      // }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxlogout,\n        params: params\n      }).then(res => {\n        return '登出成功'\n      }).catch(err => {\n        debug(err)\n        return '可能登出成功'\n      })\n    })\n  }\n\n  sendText (msg, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.MSGTYPE_TEXT,\n          'Content': msg,\n          'FromUserName': this.user['UserName'],\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendmsg,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '发送文本信息失败'\n      throw err\n    })\n  }\n\n  sendEmoticon (id, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'fun': 'sys',\n        'pass_ticket': this.PROP.passTicket,\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.MSGTYPE_EMOTICON,\n          'EmojiFlag': 2,\n          'FromUserName': this.user['UserName'],\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n\n      if (id.indexOf('@') === 0) {\n        data.Msg.MediaId = id\n      } else {\n        data.Msg.EMoticonMd5 = id\n      }\n\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendemoticon,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '发送表情信息失败'\n      throw err\n    })\n  }\n\n  // file: Stream, Buffer, File, Blob\n  uploadMedia (file, filename, toUserName) {\n    return Promise.resolve().then(() => {\n      let name, type, size, ext, mediatype, data\n      return new Promise((resolve, reject) => {\n        if ((typeof (File) !== 'undefined' && file.constructor == File) ||\n          (typeof (Blob) !== 'undefined' && file.constructor == Blob)) {\n          name = file.name || 'file'\n          type = file.type\n          size = file.size\n          data = file\n          return resolve()\n        } else if (Buffer.isBuffer(file)) {\n          if (!filename) {\n            return reject(new Error('文件名未知'))\n          }\n          name = filename\n          type = mime.lookup(name)\n          size = file.length\n          data = file\n          return resolve()\n        } else if (file.readable) {\n          if (!file.path && !filename) {\n            return reject(new Error('文件名未知'))\n          }\n          name = path.basename(file.path || filename)\n          type = mime.lookup(name)\n          file.pipe(bl((err, buffer) => {\n            if (err) {\n              return reject(err)\n            }\n            size = buffer.length\n            data = buffer\n            return resolve()\n          }))\n        }\n      }).then(() => {\n        ext = name.match(/.*\\.(.*)/)\n        if (ext) {\n          ext = ext[1].toLowerCase()\n        } else {\n          ext = ''\n        }\n\n        switch (ext) {\n          case 'bmp':\n          case 'jpeg':\n          case 'jpg':\n          case 'png':\n            mediatype = 'pic'\n            break\n          case 'mp4':\n            mediatype = 'video'\n            break\n          default:\n            mediatype = 'doc'\n        }\n\n        let clientMsgId = getClientMsgId()\n\n        let uploadMediaRequest = JSON.stringify({\n          BaseRequest: this.getBaseRequest(),\n          ClientMediaId: clientMsgId,\n          TotalLen: size,\n          StartPos: 0,\n          DataLen: size,\n          MediaType: 4,\n          UploadType: 2,\n          FromUserName: this.user.UserName,\n          ToUserName: toUserName || this.user.UserName\n        })\n\n        let form = new FormData()\n        form.append('name', name)\n        form.append('type', type)\n        form.append('lastModifiedDate', new Date().toGMTString())\n        form.append('size', size)\n        form.append('mediatype', mediatype)\n        form.append('uploadmediarequest', uploadMediaRequest)\n        form.append('webwx_data_ticket', this.PROP.webwxDataTicket)\n        form.append('pass_ticket', encodeURI(this.PROP.passTicket))\n        form.append('filename', data, {\n          filename: name,\n          contentType: type,\n          knownLength: size\n        })\n        return new Promise((resolve, reject) => {\n          if (isStandardBrowserEnv) {\n            return resolve({\n              data: form,\n              headers: {}\n            })\n          } else {\n            form.pipe(bl((err, buffer) => {\n              if (err) {\n                return reject(err)\n              }\n              return resolve({\n                data: buffer,\n                headers: form.getHeaders()\n              })\n            }))\n          }\n        })\n      }).then(data => {\n        let params = {\n          f: 'json'\n        }\n\n        return this.request({\n          method: 'POST',\n          url: this.CONF.API_webwxuploadmedia,\n          headers: data.headers,\n          params: params,\n          data: data.data\n        })\n      }).then(res => {\n        let data = res.data\n        let mediaId = data.MediaId\n        assert.ok(mediaId, res)\n\n        return {\n          name: name,\n          size: size,\n          ext: ext,\n          mediatype: mediatype,\n          mediaId: mediaId\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '上传媒体文件失败'\n      throw err\n    })\n  }\n\n  sendPic (mediaId, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'fun': 'async',\n        'f': 'json',\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.MSGTYPE_IMAGE,\n          'MediaId': mediaId,\n          'FromUserName': this.user.UserName,\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendmsgimg,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '发送图片失败'\n      throw err\n    })\n  }\n\n  sendVideo (mediaId, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'fun': 'async',\n        'f': 'json',\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.MSGTYPE_VIDEO,\n          'MediaId': mediaId,\n          'FromUserName': this.user.UserName,\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendmsgvedio,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '发送视频失败'\n      throw err\n    })\n  }\n\n  sendDoc (mediaId, name, size, ext, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'fun': 'async',\n        'f': 'json',\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.APPMSGTYPE_ATTACH,\n          'Content': `<appmsg appid='wxeb7ec651dd0aefa9' sdkver=''><title>${name}</title><des></des><action></action><type>6</type><content></content><url></url><lowurl></lowurl><appattach><totallen>${size}</totallen><attachid>${mediaId}</attachid><fileext>${ext}</fileext></appattach><extinfo></extinfo></appmsg>`,\n          'FromUserName': this.user.UserName,\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendappmsg,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '发送文件失败'\n      throw err\n    })\n  }\n\n  forwardMsg (msg, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'fun': 'async',\n        'f': 'json',\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 2,\n        'Msg': {\n          'Type': msg.MsgType,\n          'MediaId': '',\n          'Content': msg.Content.replace(/&lt;/g, '<').replace(/&gt;/g, '>'),\n          'FromUserName': this.user.UserName,\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n      let url, pm\n      switch (msg.MsgType) {\n        case this.CONF.MSGTYPE_TEXT:\n          url = this.CONF.API_webwxsendmsg\n          if (msg.SubMsgType === this.CONF.MSGTYPE_LOCATION) {\n            data.Msg.Type = this.CONF.MSGTYPE_LOCATION\n            data.Msg.Content = msg.OriContent.replace(/&lt;/g, '<').replace(/&gt;/g, '>')\n          }\n          break\n        case this.CONF.MSGTYPE_IMAGE:\n          url = this.CONF.API_webwxsendmsgimg\n          break\n        case this.CONF.MSGTYPE_EMOTICON:\n          url = this.CONF.API_webwxsendemoticon\n          params.fun = 'sys'\n          data.Msg.EMoticonMd5 = msg.Content.replace(/^[\\s\\S]*?md5\\s?=\\s?\"(.*?)\"[\\s\\S]*?$/, '$1')\n          if (!data.Msg.EMoticonMd5) {\n            throw new Error('商店表情不能转发')\n          }\n          data.Msg.EmojiFlag = 2\n          data.Scene = 0\n          delete data.Msg.MediaId\n          delete data.Msg.Content\n          break\n        case this.CONF.MSGTYPE_MICROVIDEO:\n        case this.CONF.MSGTYPE_VIDEO:\n          url = this.CONF.API_webwxsendmsgvedio\n          data.Msg.Type = this.CONF.MSGTYPE_VIDEO\n          break\n        case this.CONF.MSGTYPE_APP:\n          url = this.CONF.API_webwxsendappmsg\n          data.Msg.Type = msg.AppMsgType\n          data.Msg.Content = data.Msg.Content.replace(\n            /^[\\s\\S]*?(<appmsg[\\s\\S]*?<attachid>)[\\s\\S]*?(<\\/attachid>[\\s\\S]*?<\\/appmsg>)[\\s\\S]*?$/,\n            `$1${msg.MediaId}$2`)\n          break\n        default:\n          throw new Error('该消息类型不能直接转发')\n      }\n      return this.request({\n        method: 'POST',\n        url: url,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '转发消息失败'\n      throw err\n    })\n  }\n\n  getMsgImg (msgId) {\n    return Promise.resolve().then(() => {\n      let params = {\n        MsgID: msgId,\n        skey: this.PROP.skey,\n        type: 'big'\n      }\n\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_webwxgetmsgimg,\n        params: params,\n        responseType: 'arraybuffer'\n      }).then(res => {\n        return {\n          data: res.data,\n          type: res.headers['content-type']\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '获取图片或表情失败'\n      throw err\n    })\n  }\n\n  getVideo (msgId) {\n    return Promise.resolve().then(() => {\n      let params = {\n        MsgID: msgId,\n        skey: this.PROP.skey\n      }\n\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_webwxgetvideo,\n        headers: {\n          'Range': 'bytes=0-'\n        },\n        params: params,\n        responseType: 'arraybuffer'\n      }).then(res => {\n        return {\n          data: res.data,\n          type: res.headers['content-type']\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '获取视频失败'\n      throw err\n    })\n  }\n\n  getVoice (msgId) {\n    return Promise.resolve().then(() => {\n      let params = {\n        MsgID: msgId,\n        skey: this.PROP.skey\n      }\n\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_webwxgetvoice,\n        params: params,\n        responseType: 'arraybuffer'\n      }).then(res => {\n        return {\n          data: res.data,\n          type: res.headers['content-type']\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '获取声音失败'\n      throw err\n    })\n  }\n\n  getHeadImg (HeadImgUrl) {\n    return Promise.resolve().then(() => {\n      let url = this.CONF.origin + HeadImgUrl\n      return this.request({\n        method: 'GET',\n        url: url,\n        responseType: 'arraybuffer'\n      }).then(res => {\n        return {\n          data: res.data,\n          type: res.headers['content-type']\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '获取头像失败'\n      throw err\n    })\n  }\n\n  getDoc (FromUserName, MediaId, FileName) {\n    return Promise.resolve().then(() => {\n      let params = {\n        sender: FromUserName,\n        mediaid: MediaId,\n        filename: FileName,\n        fromuser: this.user.UserName,\n        pass_ticket: this.PROP.passTicket,\n        webwx_data_ticket: this.PROP.webwxDataTicket\n      }\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_webwxdownloadmedia,\n        params: params,\n        responseType: 'arraybuffer'\n      }).then(res => {\n        return {\n          data: res.data,\n          type: res.headers['content-type']\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '获取文件失败'\n      throw err;\n    })\n  }\n\n  verifyUser (UserName, Ticket) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'lang': 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Opcode': 3,\n        'VerifyUserListSize': 1,\n        'VerifyUserList': [{\n          'Value': UserName,\n          'VerifyUserTicket': Ticket\n        }],\n        'VerifyContent': '',\n        'SceneListCount': 1,\n        'SceneList': [33],\n        'skey': this.PROP.skey\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxverifyuser,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '通过好友请求失败'\n      throw err\n    })\n  }\n\n    /**\n     * 添加好友\n     * @param UserName 待添加用户的UserName\n     * @param content\n     * @returns {Promise.<TResult>}\n     */\n  addFriend (UserName, content = '我是' + this.user.NickName) {\n    let params = {\n      'pass_ticket': this.PROP.passTicket,\n      'lang': 'zh_CN'\n    }\n\n    let data = {\n      'BaseRequest': this.getBaseRequest(),\n      'Opcode': 2,\n      'VerifyUserListSize': 1,\n      'VerifyUserList': [{\n        'Value': UserName,\n        'VerifyUserTicket': ''\n      }],\n      'VerifyContent': content,\n      'SceneListCount': 1,\n      'SceneList': [33],\n      'skey': this.PROP.skey\n    }\n\n    return this.request({\n      method: 'POST',\n      url: this.CONF.API_webwxverifyuser,\n      params: params,\n      data: data\n    }).then(res => {\n      let data = res.data\n      assert.equal(data.BaseResponse.Ret, 0, res)\n      return data\n    }).catch(err => {\n      debug(err)\n      err.tips = '添加好友失败'\n      throw err\n    })\n  }\n\n  // Topic: Chatroom name\n  // MemberList format:\n  // [\n  //   {\"UserName\":\"@250d8d156ad9f8b068c2e3df3464ecf2\"},\n  //   {\"UserName\":\"@42d725733741de6ac53cbe3738d8dd2e\"}\n  // ]\n  createChatroom (Topic, MemberList) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'lang': 'zh_CN',\n        'r': ~new Date()\n      }\n      let data = {\n        BaseRequest: this.getBaseRequest(),\n        MemberCount: MemberList.length,\n        MemberList: MemberList,\n        Topic: Topic\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxcreatechatroom,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '创建群失败'\n      throw err\n    })\n  }\n\n  // fun: 'addmember' or 'delmember' or 'invitemember'\n  updateChatroom (ChatRoomUserName, MemberList, fun) {\n    return Promise.resolve().then(() => {\n      let params = {\n        fun: fun\n      }\n      let data = {\n        BaseRequest: this.getBaseRequest(),\n        ChatRoomName: ChatRoomUserName\n      }\n      if (fun === 'addmember') {\n        data.AddMemberList = MemberList.toString()\n      } else if (fun === 'delmember') {\n        data.DelMemberList = MemberList.toString()\n      } else if (fun === 'invitemember') {\n        data.InviteMemberList = MemberList.toString()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxupdatechatroom,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '邀请或踢出群成员失败'\n      throw err\n    })\n  }\n\n  // OP: 1 联系人置顶 0 取消置顶\n  // 若不传RemarkName，则会覆盖以设置的联系人备注名\n  opLog (UserName, OP, RemarkName) {\n    return Promise.resolve().then(() => {\n      let params = {\n        pass_ticket: this.PROP.passTicket\n      }\n      let data = {\n        BaseRequest: this.getBaseRequest(),\n        CmdId: 3,\n        OP: OP,\n        RemarkName: RemarkName,\n        UserName: UserName\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxoplog,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '置顶或取消置顶失败'\n      throw err\n    })\n  }\n\n  updateRemarkName (UserName, RemarkName) {\n    return Promise.resolve().then(() => {\n      let params = {\n        pass_ticket: this.PROP.passTicket,\n        'lang': 'zh_CN'\n      }\n      let data = {\n        BaseRequest: this.getBaseRequest(),\n        CmdId: 2,\n        RemarkName: RemarkName,\n        UserName: UserName\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxoplog,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      err.tips = '设置用户标签失败'\n      throw err\n    })\n  }\n\n  updateChatRoomName (ChatRoomUserName, NewName) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'fun': 'modtopic'\n      }\n      let data = {\n        BaseRequest: this.getBaseRequest(),\n        ChatRoomName: ChatRoomUserName,\n        NewTopic: NewName\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxupdatechatroom,\n        params: params,\n        data: data\n      }).then(res => {\n        console.log(JSON.stringify(res))\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('更新群名失败')\n    })\n  }\n\n  revokeMsg (msgId, toUserName) {\n    return Promise.resolve().then(() => {\n      let data = {\n        BaseRequest: this.getBaseRequest(),\n        SvrMsgId: msgId,\n        ToUserName: toUserName,\n        ClientMsgId: getClientMsgId()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxrevokemsg,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('撤回消息失败')\n    })\n  }\n\n  getBaseRequest () {\n    return {\n      Uin: parseInt(this.PROP.uin),\n      Sid: this.PROP.sid,\n      Skey: this.PROP.skey,\n      DeviceID: getDeviceID()\n    }\n  }\n}\n"]}